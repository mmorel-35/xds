# Python protobuf sources generated by Buf  
# All *_pb2.py files are generated by Buf and committed to the repository
# To regenerate: run `buf generate` from repository root

# Collect all Python protobuf files generated by Buf
filegroup(
    name = "python_proto_sources",
    srcs = glob([
        "**/*_pb2.py",
    ]),
    visibility = ["//visibility:public"],
)

# Python library with all generated protobuf code
py_library(
    name = "python_default_library",
    srcs = [":python_proto_sources"],
    visibility = ["//visibility:public"],
    deps = [
        "@com_google_protobuf//:protobuf_python",
    ],
)

# Alias for backward compatibility
alias(
    name = "python",
    actual = ":python_default_library",
    visibility = ["//visibility:public"],
)

# Manual generation trigger (for development only)
sh_binary(
    name = "generate_python",
    srcs = ["//tools:buf_generate.sh"],
    data = [
        "//:buf.gen.yaml", 
        "//:buf.yaml",
    ],
    visibility = ["//visibility:public"],
)